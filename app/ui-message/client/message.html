<template name="message">
	<li id="{{templatePrefix}}{{msg._id}}" data-id="{{msg._id}}" data-context={{actionContext}} class="message {{ignoredClass}} {{system}} {{t}} {{own}} {{isTemp}} {{chatops}} {{collapsed}} {{customClass}}" data-username="{{msg.u.username}}" data-tmid="{{msg.tmid}}" data-groupable="{{isGroupable}}" data-date="{{date}}" data-timestamp="{{timestamp}}" data-alias="{{msg.alias}}">
		{{#if isThreadReply}}
			{{> messageThread parentMessage=parentMessage threadMessage=threadMessage following=msg.following avatar=msg.u.username msg=msg body=body class=bodyClass}}
		{{else}}
			{{#if msg.avatar}}
				{{#if avatarFromUsername}}
					<button aria-label="{{msg.u.username}}" class="thumb user-card-message" data-username="{{msg.u.username}}">
						{{> avatar username=avatarFromUsername}}
					</button>
				{{else}}
					<button aria-label="{{msg.u.username}}" class="thumb user-card-message" data-username="{{msg.u.username}}">
						<div class="avatar">
							<div class="avatar-image" style="background-image:url({{encodeURI msg.avatar}})"></div>
						</div>
					</button>
				{{/if}}
			{{else}}
				{{#if msg.emoji}}
					<button aria-label="{{msg.u.username}}" class="thumb user-card-message" data-username="{{msg.u.username}}">
						<div class="avatar">
							{{> renderEmoji msg.emoji}}
						</div>
					</button>
				{{else}}
					<button aria-label="{{msg.u.username}}" class="thumb user-card-message" data-username="{{msg.u.username}}">
						{{> avatar username=msg.u.username}}
					</button>
				{{/if}}
			{{/if}}
			<div class="message-body-wrapper">
				<div class="title border-component-color color-info-font-color">
					<button type="button" class="user user-card-message color-primary-font-color" data-username="{{msg.u.username}}" tabindex="1">
						{{getName}}{{#if showUsername}} <span class="message-alias border-component-color color-info-font-color">@{{msg.u.username}}</span>{{/if}}
					</button>
					{{#if getStatus}}
						<button class="message-custom-status rc-tooltip rc-tooltip--up rc-tooltip--start" aria-label="{{getStatus}}">ðŸ’¬</button>
					{{/if}}
					<span class="info border-component-color color-info-font-color"></span>
					{{#each role in roleTags}}
						<span  class="role-tag color-secondary-color border-component-color" data-role="{{role.description}}">{{role.description}}</span>
					{{/each}}
					{{#if isBot}}
						<span class="is-bot color-secondary-color border-component-color">{{_ "Bot"}}</span>
					{{/if}}
					<time class="time" title='{{date}} {{time}} {{zoneAbbr}}' datetime='{{date}} {{time}} {{zoneAbbr}}'>{{time}} {{zoneAbbr}}</time>
					<time class="time" title='{{dateinNextZone}}  {{zoneAbbrInNextLabel}}' datetime='{{dateinNextZone}} {{timeInNextZone}} {{zoneAbbrInNextLabel}}'>{{timeInNextZone}} {{zoneAbbrInNextLabel}}</time>
					{{#each value in messageTags}}
					<span style="border-color: #f2f3f5;background: rgba(0,0,0,0.05); border-radius: 8px; border-width: 2px ; " taggedBy = {{value.userId}} value={{value.tagName}} class="tag-click role-tag color-secondary-color border-component-color" >{{value.tagName}}</span>

					{{/each}}
					{{ #if isTaggedA}}
					<span class="role-tag color-secondary-color border-component-color" >TAG A</span>

					{{/if}}
					{{ #if isTaggedB}}
					<span class="role-tag color-secondary-color border-component-color" >TAG B</span>
					
					{{/if}}
					{{ #if isTaggedC}}
					<span class="role-tag color-secondary-color border-component-color" >TAG C</span>
				 
					{{/if}}
					
					{{#if showTranslated}}
						<span class="translated">
							<i class="icon-language {{#if msg.autoTranslateFetching}}loading{{/if}}" aria-label="{{_ "Translated"}}"></i>
							<span class="translation-provider">{{ translationProvider }}</span>
						</span>
					{{/if}}
					{{#if msg.sentByEmail}}
						<span class="sent-by-email">
							<i class="icon-mail" title='{{_ "Message_sent_by_email"}}' aria-label='{{_ "Message_sent_by_email"}}'></i>
						</span>
					{{/if}}
					{{#if edited}}
						<span class="edited" title='{{_ "edited"}} {{_ "at"}} {{editTime}} {{_ "by"}} {{editedBy}}'>
							<i class="icon-pencil{{#if $neq editedBy msg.u.username}} error-color{{/if}}" aria-label="{{_ "Edited"}}"></i>
						</span>
					{{/if}}
					{{#if showStar}}
						<span aria-label="{{_ "Message_has_been_starred"}}" class="starred rc-tooltip rc-tooltip--up rc-tooltip--start"><i class="icon-star"></i></span>
					{{/if}}
					{{#if msg.alert}}
						<div aria-label="{{_ msg.alert }}" class="rc-tooltip message-unread"></div>
					{{/if}}
					{{#if msg.private}}
						<span class="private">{{_ "Only_you_can_see_this_message"}}</span>
					{{/if}}
					{{#if fromSearch}}
						<span class="user color-info-font-color">
							{{>icon icon=roomIcon}}{{channelName}}
						</span>
					{{/if}}
					{{#if isIgnored}}
						<span class="toggle-hidden icon-right-dir" data-message="{{msg._id}}"> {{_ "Message_Ignored"}} </span>
					{{/if}}
				</div>
				<div class="body {{bodyClass}}" dir="auto" data-unread-text="{{_ "Unread_Messages"}}">
					{{#if isSnippet}}
						<div class="snippet-name">{{_ "Snippet_name"}}: {{snippetName}}</div>
					{{/if}}
					{{#if msg.blocks}}
						<div class='rc-ui-kit'>
							{{> Blocks blocks=msg.blocks rid=msg.rid mid=msg._id}}
						</div>
					{{else}}
						{{#if isDecrypting}}
							<span>******</span>
						{{else}}
							{{{body}}}
						{{/if}}
					{{/if}}
				</div>
			</div>

			{{#if hasOembed}}
				{{#each msg.urls}}
					{{injectMessage . ../msg}}
					{{injectSettings . ../settings}}
					{{injectIndex . @index}}
					{{> oembedBaseWidget}}
				{{/each}}
			{{/if}}
			{{#each msg.attachments}}
				{{injectMessage . ../msg}}
				{{injectSettings . ../settings}}
				{{injectIndex . @index}}
				{{> messageAttachment}}
			{{/each}}

			{{#if msg.drid}}
				<div class="message-discussion">
					{{#if $gt msg.dcount 0}}
						<button class="js-navigate-to-discussion rc-button rc-button--primary rc-button--small" data-rid={{roomId}}>
							<!-- {{> icon icon="discussion"}} -->
							<span>{{{_ 'message_counter' counter=i18nDiscussionCounter count=msg.dcount }}}</span>
						</button>
					{{else}}
						<button class="js-navigate-to-discussion rc-button rc-button--primary rc-button--small no-replies" data-rid={{roomId}}>
							{{_ "No_messages_yet" }}
						</button>
					{{/if}}
					<span class="discussion-reply-lm">{{ formatDateAndTime msg.dlm }}</span>
				</div>
			{{/if}}

			{{#if $and settings.showReplyButton msg.tcount}}
				<div class="message-discussion">
					<button class="js-open-thread rc-button rc-button--primary rc-button--small" data-rid={{roomId}}>
						{{> icon icon="thread"}}
						<span>{{{_ 'reply_counter' counter=i18nReplyCounter count=msg.tcount }}}</span>
					</button>
					<span class="discussion-reply-lm">{{ formatDateAndTime msg.tlm}}</span>
				</div>
			{{/if}}

			{{#with readReceipt}}
				<div class="read-receipt {{readByEveryone}}">
					{{> icon icon="check" }}
				</div>
			{{/with}}
			{{#unless hideMessageActions}}
				<div class="message-actions" >
				   <div  class = "dropdown">
					<button id="opendropdown_for-actions__button" style="margin: 0.2rem;"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
						width="15px" height="15px" viewBox="0 0 432.544 432.544" style="enable-background:new 0 0 432.544 432.544;"
						xml:space="preserve">
				   <g>
					   <path d="M421.985,229.833L217.847,25.981c-7.235-7.238-16.94-13.374-29.121-18.416C176.541,2.522,165.407,0,155.318,0H36.547
						   C26.648,0,18.083,3.619,10.85,10.848C3.617,18.081,0.002,26.646,0.002,36.545v118.771c0,10.088,2.519,21.219,7.564,33.404
						   s11.182,21.792,18.417,28.837L230.118,421.98c7.043,7.043,15.602,10.564,25.697,10.564c9.89,0,18.558-3.521,25.98-10.564
						   l140.186-140.47c7.043-7.046,10.561-15.604,10.561-25.693C432.542,245.919,429.024,237.258,421.985,229.833z M117.202,117.201
						   c-7.142,7.138-15.752,10.709-25.841,10.709c-10.085,0-18.699-3.571-25.837-10.709c-7.138-7.139-10.706-15.749-10.706-25.837
						   c0-10.089,3.568-18.702,10.706-25.837c7.139-7.139,15.752-10.71,25.837-10.71c10.089,0,18.702,3.571,25.841,10.71
						   c7.135,7.135,10.706,15.749,10.706,25.837C127.908,101.452,124.341,110.062,117.202,117.201z"/>
				   </g><g></g>
				   <g> </g><g></g><g> </g> <g></g> <g></g> <g> </g> <g></g> <g> </g><g> </g><g> </g> <g> </g> <g></g> <g> </g> <g> </g>
				   </svg></button>
					<div id="myDropdown" class="dropdown-content " style = "margin-left: 4px; display:{{showTagDropdown}}">
					  {{#each value in roomTags}}
					  <div data-value="{{@index}}" id="{{@index}}" class="tags_action" style="cursor: pointer;">
						{{value}}
					</div >
					  {{/each}}
					</div>
				  </div>
					<div class="message-actions__buttons">
						{{#each action in messageActions 'message'}}
							<button class="message-actions__button"  data-message-action="{{action.id}}" title="{{_ action.label}}">
									{{> icon block="message-actions__button-icon" icon=action.icon}}
							</button>
						{{/each}}
					</div>
					<div class="message-actions__menu" aria-haspopup="true">
						{{> icon block="message-actions__menu-icon" icon="menu"}}
					</div>
				</div>
			{{/unless}}
			{{#unless hideActionLinks}}
			<ul class="actionLinks">
				{{#each actionLink in actionLinks}}
					<li class="color-primary-action-color">
						<span class="rc-button rc-button--primary rc-button--small" style="display: inline-block; line-height: 1.75rem" data-actionlink="{{actionLink.id}}">
							{{#if actionLink.icon}}
								<i class="{{actionLink.icon}}"></i>
							{{/if}}
							{{#if actionLink.i18nLabel}}
								{{_ actionLink.i18nLabel}}
							{{else}}
								{{actionLink.label}}
							{{/if}}
						</span>
					</li>
				{{/each}}
			</ul>
			{{/unless}}
			{{#if broadcast}}
				<button type="button" class="js-reply-broadcast rc-button rc-button--primary rc-button--small rc-button--outline" name="button">
					{{> icon icon="reply"}} {{_'Reply'}}
				</button>
			{{/if}}
			{{#unless hideReactions}}
			<ul class="reactions">
				{{#each reaction in reactions}}
					<li data-emoji="{{reaction.emoji}}" {{markUserReaction reaction}}>
						<span class="reaction-emoji">{{> renderEmoji reaction.emoji}}</span>
						<span class="reaction-count">{{reaction.count}}</span>
						<span class="people" style="font-weight: bold">
							{{reaction.usernames}} <span style="color: #aaa;">{{reaction.reaction}}</span>
						</span>
					</li>
				{{/each}}
				<li class="add-reaction">
					<span class="icon-people-plus"></span>
				</li>
			</ul>
			{{/unless}}
		{{/if}}
	</li>

	{{#if isTagClicked}}

	<div class="rc-tagmodal-wrapper">
		<dialog id="modal_tag" class="rc-tagmodal">
				<header class="rc-tagmodal__header">
					<h1 class="rc-tagmodal__title">
					Please Confirm the Action
					</h1>
				
				</header>


				<!-- <section  class="rc-tagmodal__content">
				hellooooo
						<div style="margin-bottom: 90px;">
							"text"
						</div>
					
					</section> -->
					<!-- {{# if showFooter }} -->
						<footer  class="rc-tagmodal__footer rc-modal__footer--empty">
							<div class="footer__dialog">
									<button class="tagModalBtns Cancel_tag">Cancel</button>
								<button class="tagModalBtns SearchTag">Search</button>
								<button title="Delete Tag" class="delete_the_tag"><svg height="20px" viewBox="-57 0 512 512" width="20px" xmlns="http://www.w3.org/2000/svg"><path d="m156.371094 30.90625h85.570312v14.398438h30.902344v-16.414063c.003906-15.929687-12.949219-28.890625-28.871094-28.890625h-89.632812c-15.921875 0-28.875 12.960938-28.875 28.890625v16.414063h30.90625zm0 0"/><path d="m344.210938 167.75h-290.109376c-7.949218 0-14.207031 6.78125-13.566406 14.707031l24.253906 299.90625c1.351563 16.742188 15.316407 29.636719 32.09375 29.636719h204.542969c16.777344 0 30.742188-12.894531 32.09375-29.640625l24.253907-299.902344c.644531-7.925781-5.613282-14.707031-13.5625-14.707031zm-219.863282 312.261719c-.324218.019531-.648437.03125-.96875.03125-8.101562 0-14.902344-6.308594-15.40625-14.503907l-15.199218-246.207031c-.523438-8.519531 5.957031-15.851562 14.472656-16.375 8.488281-.515625 15.851562 5.949219 16.375 14.472657l15.195312 246.207031c.527344 8.519531-5.953125 15.847656-14.46875 16.375zm90.433594-15.421875c0 8.53125-6.917969 15.449218-15.453125 15.449218s-15.453125-6.917968-15.453125-15.449218v-246.210938c0-8.535156 6.917969-15.453125 15.453125-15.453125 8.53125 0 15.453125 6.917969 15.453125 15.453125zm90.757812-245.300782-14.511718 246.207032c-.480469 8.210937-7.292969 14.542968-15.410156 14.542968-.304688 0-.613282-.007812-.921876-.023437-8.519531-.503906-15.019531-7.816406-14.515624-16.335937l14.507812-246.210938c.5-8.519531 7.789062-15.019531 16.332031-14.515625 8.519531.5 15.019531 7.816406 14.519531 16.335937zm0 0"/><path d="m397.648438 120.0625-10.148438-30.421875c-2.675781-8.019531-10.183594-13.429687-18.640625-13.429687h-339.410156c-8.453125 0-15.964844 5.410156-18.636719 13.429687l-10.148438 30.421875c-1.957031 5.867188.589844 11.851562 5.34375 14.835938 1.9375 1.214843 4.230469 1.945312 6.75 1.945312h372.796876c2.519531 0 4.816406-.730469 6.75-1.949219 4.753906-2.984375 7.300781-8.96875 5.34375-14.832031zm0 0"/></svg></button>
								 </div>
						</footer>
					<!-- {{/if}} -->
			
			</dialog>
		
	</div>
	{{/if}}

	{{#if isTagSearchClicked}}

	<div class="rc-tagSearchmodal-wrapper">
		<dialog  class="rc-tagSearchmodal">
				<header class="rc-tagSearchmodal__header">
					<h1 class="rc-tagSearchmodal__title">
					Tagged Messages {{tagName}}
					</h1>
					<h1 class="close_tagged_message_dialog"  title="Close" >
							<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 18 18"><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"/></svg>								
							</h1>
				</header>
				


				<section style="max-height: 80%;" class="rc-tagmodal__content">
						<ul>
							
				{{#each item in listOfTaggedMsgs}}
				<li style="margin-top: 20px;" id="{{templatePrefix}}{{item._id}}" data-id="{{item._id}}" class=" message {{ignoredClass}} {{system}} {{t}} {{own}} {{isTemp}} {{chatops}} {{collapsed}} {{customClass}}" data-username="{{item.u.username}}" data-tmid="{{item.tmid}}" data-groupable="{{isGroupable}}" data-date="{{date}}" data-timestamp="{{timestamp}}" data-alias="{{item.alias}}">
					{{#if isThreadReply}}
					{{else}}
						{{#if item.avatar}}
							{{#if avatarFromUsername}}
								<button aria-label="{{item.u.username}}" class="thumb user-card-message" data-username="{{item.u.username}}">
									{{> avatar username=avatarFromUsername}}
								</button>
							{{else}}
								<button aria-label="{{item.u.username}}" class="thumb user-card-message" data-username="{{item.u.username}}">
									<div class="avatar">
										<div class="avatar-image" style="background-image:url({{encodeURI item.avatar}})"></div>
									</div>
								</button>
							{{/if}}
						{{else}}
							{{#if msg.emoji}}
								<button aria-label="{{item.u.username}}" class="thumb user-card-message" data-username="{{item.u.username}}">
									<div class="avatar">
										{{> renderEmoji item.emoji}}
									</div>
								</button>
							{{else}}
								<button aria-label="{{item.u.username}}" class="thumb user-card-message" data-username="{{item.u.username}}">
									{{> avatar username=item.u.username}}
								</button>
							{{/if}}
						{{/if}}
						<div class="message-body-wrapper">
							<div class="title border-component-color color-info-font-color">
								<button type="button" class="user user-card-message color-primary-font-color" data-username="{{item.u.username}}" tabindex="1">
									{{getName}}{{#if showUsername}} <span class="message-alias border-component-color color-info-font-color">@{{item.u.username}}</span>{{/if}}
								</button>
								{{#if getStatus}}
									<button class="message-custom-status rc-tooltip rc-tooltip--up rc-tooltip--start" aria-label="{{getStatus}}">ðŸ’¬</button>
								{{/if}}
								<span class="info border-component-color color-info-font-color"></span>
								{{#each role in roleTags}}
									<span class="role-tag color-secondary-color border-component-color" data-role="{{role.description}}">{{role.description}}</span>
								{{/each}}
								{{#if isBot}}
									<span class="is-bot color-secondary-color border-component-color">{{_ "Bot"}}</span>
								{{/if}}
								<time class="time" title='{{item.date}} {{item.time}}' datetime='{{item.date}} {{item.time}}'>{{item.time}}</time>
										
								{{#if showTranslated}}
									<span class="translated">
										<i class="icon-language {{#if msg.autoTranslateFetching}}loading{{/if}}" aria-label="{{_ "Translated"}}"></i>
										<span class="translation-provider">{{ translationProvider }}</span>
									</span>
								{{/if}}
								{{#if msg.sentByEmail}}
									<span class="sent-by-email">
										<i class="icon-mail" title='{{_ "Message_sent_by_email"}}' aria-label='{{_ "Message_sent_by_email"}}'></i>
									</span>
								{{/if}}
								{{#if edited}}
									<span class="edited" title='{{_ "edited"}} {{_ "at"}} {{editTime}} {{_ "by"}} {{editedBy}}'>
										<i class="icon-pencil{{#if $neq editedBy msg.u.username}} error-color{{/if}}" aria-label="{{_ "Edited"}}"></i>
									</span>
								{{/if}}
								
								{{#if msg.private}}
									<span class="private">{{_ "Only_you_can_see_this_message"}}</span>
								{{/if}}
								{{#if fromSearch}}
									<span class="user color-info-font-color">
										{{>icon icon=roomIcon}}{{channelName}}
									</span>
								{{/if}}
								{{#if isIgnored}}
									<span class="toggle-hidden icon-right-dir" data-message="{{msg._id}}"> {{_ "Message_Ignored"}} </span>
								{{/if}}
							</div>
							<div class=" {{bodyClass}}" dir="auto" data-unread-text="{{_ "item.msg"}}">
								{{#if isSnippet}}
									<div class="snippet-name">{{_ "Snippet_name"}}: {{snippetName}}</div>
								{{/if}}
								{{#if item.blocks}}
									<div class='rc-ui-kit'>
										{{> Blocks blocks=item.blocks rid=item.rid mid=item._id}}
									</div>
								{{else}}
									{{#if isDecrypting}}
										<span>******</span>
									{{else}}
										{{{item.bodyMsg}}}
									{{/if}}
								{{/if}}
							</div>
						</div>
			
						{{#if hasOembed}}
							{{#each item.urls}}
								{{injectMessage . ../item}}
								{{injectSettings . ../settings}}
								{{injectIndex . @index}}
								{{> oembedBaseWidget}}
							{{/each}}
						{{/if}}
						{{#each item.attachments}}
							{{injectMessage . ../item}}
							{{injectSettings . ../settings}}
							{{injectIndex . @index}}
							{{> messageAttachment}}
						{{/each}}
			
					
						
					
					{{/if}}
				</li>

				{{/each}}

			</ul>
					
					</section>
					<!-- {{# if showFooter }} -->
						<footer class="rc-tagSearchmodal__footer rc-modal__footer--empty">
							<div >
							
								 </div>
						</footer>
					<!-- {{/if}} -->
			
			</dialog>
		
	</div>
	{{/if}}
</template>